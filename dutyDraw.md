以下は 「Duty Drawback（関税還付）自動化 SaaS」 を想定した設計メモです。
日本制度（外戻し・再輸出減税／免税）を中心にまとめていますが、米・EU など多国展開も同じ構成で横展開できます。

⸻

1. サービス概要

項目	内容
目的	輸入時に支払った関税・消費税を、完成品を輸出したタイミングで自動で突合・還付請求し、キャッシュフローを改善。
対象ユーザ	メーカー・商社・3PL・フォワーダー・越境EC事業者
主要アウトプット	① NACCS「再輸出減税（G14）／再輸出免税（G15）」電文生成② 関税還付請求書（C様式）PDF③ 仕入れ関税額 vs. 還付額レポート
提供形態	Webアプリ (Next.js + Supabase) / REST・GraphQL API / SAP・OBIC ERP コネクタ
課金モデル	月額 + 還付額の○％を成果報酬（完全従量でも可）



⸻

2. 主なユースケース
	1.	輸入データ取込
	•	NACCS IDS や税関CSV、商社のインボイスを API / SFTP で自動連携
	2.	輸出データ取込
	•	NACCS [FOB] データ、海外FZ倉庫 EDI、ECプラットフォーム配送実績
	3.	マッチング & シミュレーション
	•	HSコード・数量・単価・BOM を用い、「還付対象/非対象」「残高」をリアルタイム計算
	4.	電子申請
	•	NACCS 電文 G14（再輸出減税）・G15（再輸出免税）を自動送信 ￼
	•	添付書類（C-1020 修正申告書 等）PDF に差し込み ￼
	5.	審査ステータス追跡 & 会計仕訳
	•	税関返戻データをポーリングし、会計ソフト仕訳を自動起票
	6.	監査ログ & KPI ダッシュボード
	•	「還付率」「平均回収日数」「未請求残高」を可視化

⸻

3. 機能一覧と技術的実現方法

#	機能	詳細	実装ポイント
F1	データインジェスト	IDS XML / NACCS CSV / Excel を自動取込	・Supabase Storage へアップ→csv-parseでETL・SFTPWatch → Cloud Tasks queue
F2	BOM 展開 & マッチング	部品→完成品を HS6桁単位でリンク	・PostgreSQL 数量追跡テーブル (remaining_qty)・ltree で階層 BOM を高速照会
F3	還付シミュレーション	払込関税 - (再輸出数量×税率) をリアルタイム計算	・Postgres WITH RECURSIVE で合算・GraphQL Resolver でシミュ結果返却
F4	NACCS電文生成	G14/G15 XML + 添付 PDF を一括送信	・xmlbuilder2 で XSD 準拠電文・Signet PKI で電子署名（gBizID連携）
F5	還付請求書PDF（C様式）	C-1020/C-1030 などへ自動差込	・playwright + Acrobat SDK でフォームフィールド埋込
F6	ステータストラッキング	税関応答電文→Webhookで取り込み	・Redis Streams でリトライ・失敗時は Slack & Sentry 通知
F7	会計連携	弥生・freee・SAP仕訳API	・Stripe Payout Webhook→Journal Entries
F8	監査ログ/WORM保管	電文・計算結果・PDFをHash化し5年保管	・AWS S3 Object-Lock（Compliance モード）



⸻

4. 専門用語解説

用語	意味・背景
Duty Drawback（外戻し関税）	輸入時に課税された関税等を、当該貨物または加工後製品を輸出した際に返還する制度。資金拘束を減らすキャッシュマネジメント策。
再輸出減税（G14）／再輸出免税（G15）	日本 NACCS で用いられる電文コード。輸入貨物を加工せず再輸出する場合に、支払済み関税を減税（還付）または免税扱いにする申請。 ￼
C様式（C-1020 / 1030 など）	税関が公表している「関税修正申告書」「関税更正請求書」等の定型様式。還付請求時の PDF 生成対象。 ￼
NACCS (Nippon Automated Cargo and Port Consolidated System)	税関・港湾・通関業者・船社をつなぐ電子申告プラットフォーム。再輸出関係や DRAWBACK も電文で申請可能。
BOM (Bill of Materials)	製品構成表。原材料～完成品の数量関係を管理し、還付対象数量を算出する根拠データ。
FOB Value	Free On Board (本船渡し) 価格。輸出申告書に記載され、還付計算の基準になることが多い。
HSコード	国際統一商品分類。輸入・輸出申告の必須項目。還付申請では輸入時と同じ HS6桁を紐づける必要がある。
修正申告／更正請求	既に確定した関税額を後から訂正・返金請求する税関手続き。C-1020 (修正) / C-1030 (更正) を使用。



⸻

5. MVPロードマップ（例：10週間）

期間	Deliverable
Week 1-2	F1/F2 POC：NACCS CSV → Postgres 取込 & BOM 突合
Week 3-4	F3シミュレーション UI、還付見込額ダッシュボード
Week 5-6	G14/G15 XML 生成 & 手動アップロードでテスト送信
Week 7-8	PDF (C-1020) 自動生成、電子署名パイプライン
Week 9-10	税関応答電文解析 → ステータス追跡 & 会計連携



⸻

次のステップ
	•	NACCS 開発者テスト環境の利用申請
	•	インポート／エクスポート CSV 標準フォーマットの確定
	•	BOM 展開ロジックの詳細設計（部分輸出・残高管理アルゴリズム）

詳細 ER 図や電文 XSD サンプルが必要であれば、すぐ共有できます。お気軽に！