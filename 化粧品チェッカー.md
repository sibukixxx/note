化粧品 INCI チェック & 多国ラベル自動生成 SaaS – 設計概要

⸻

1. サービス概要

項目	内容
目的	フォーミュレーター／OEM／D2Cブランドが配合表（INCIリスト）をアップロードするだけで、各国規制チェック・警告・ラベル／通知用データを一括生成。
対象地域（初期）	EU (1223/2009)、米国 MoCRA、英国、カナダ、オーストラリア、中国 CSAR／NMPA、ASEAN六か国
主要アウトプット	① 禁止・制限成分のアラート＋許容最大濃度計算② EU CPNP／UK SCPN用 XML / XLSX、中国 NMPA原料安全コード表、米国 MoCRAアレルゲン一覧③ 各国言語ラベル（成分順序自動並べ替え）PDF／SVG④ SDS/MSDS v3.0 ひな型
提供形態	Webアプリ (Next.js + Supabase) / REST & GraphQL API / Adobe Illustrator用拡張スクリプト
課金	月額＋従量：チェック1フォーミュラ=50円、ラベル生成1言語=30円、CPNP/XML出力=100円



⸻

2. コアワークフロー
	1.	INCIリスト入力（CSV/Excel/JSON あるいは LIMS API）
	2.	リアルタイム検証
	•	禁止成分・制限濃度を国別テーブルで突合
	•	配合濃度を用い「最終製品中濃度」を計算
	3.	アクション提案
	•	置換候補成分、最大濃度OK/NG、アレルゲン表示義務
	4.	ワンクリック出力
	•	国別ラベル PDF（成分順序、パクト(“PAO”)、ネット量、警告文）
	•	役所ポータル提出用ファイル（例：EU CPNP XML、NMPA Excel、MoCRA CSV）
	5.	履歴 & 監査
	•	チェック時点の法規バージョン、数式、原料 SDS/IFRA をハッシュ化保存

⸻

3. 機能一覧と実装アプローチ

#	機能	詳細	実装例

F1	成分パーサ	INCI辞書で表記ゆれを正規化（例：“Aqua/Water/Eau”）	PostgreSQL trigram + Levenshtein、補完に OpenAI o3 function calling
F2	国別規制チェック	EU Annex II「禁止」・Annex III「制限」、米MoCRAアレルゲン、中国 NMPA禁止リスト等を突合	週次 GitHub Actions で ECHA CSV / FDA FR ドキュメントをスクレイプし、差分マイグレーション ￼ ￼
F3	最大濃度計算	各成分%とキャリア量から製品中濃度→上限超過アラート	TypeScript データクラス + Zod スキーマで単位整合性チェック
F4	アレルゲン自動抽出	香料ベース原料を展開し、EU26種/米MoCRA成分を拾う	「香料」原料に紐づく成分CASリストを展開、正規表現 + CAS索引
F5	ラベルジェネレーター	表示順序（濃度降順→1%未満ABC順）・INCI多言語・警告文挿入	node-canvas で SVG テンプレ塗り替え→PDFKit で埋め込みフォント生成
F6	規制通知ファイル生成	EU CPNP XML、UK SCPN XLSX、NMPA Excel 等	xmlbuilder2 / exceljs。提出ポータルの XSD をCIでスキーマバリデーション
F7	AI代替案提案	NG成分を低刺激代替品へ置換案 + 主要サプライヤリンク	LLM + Supabase RLS、「IFRA適合」タグでフィルタリング
F8	履歴・監査ログ	チェック結果 JSON＋法規バージョンをSHA256→保存5年	PostgreSQL -> S3 （非公開バケット、ObjectLock WORM）
F9	API & Webhook	/v1/validate, /v1/label/{locale}, /v1/cpnp など	Hono Edge Functions、JWT Auth、Stripe metered usage middleware
F10	管理ダッシュボード	利用量、失敗ログ、法規データ差分	tRPC + Grafana Cloud (PromQL)、異常は Slack Webhook



⸻

4. 用語解説（抜粋）

用語	意味
INCI (International Nomenclature Cosmetic Ingredient)	化粧品原料の国際名称。全世界で共通使用され、米国PCPCが管理。 ￼
CPNP (Cosmetic Product Notification Portal)	EU域内で化粧品上市前に成分・ラベル情報を提出するECポータル。紙提出は不要になる。 ￼
Annex II/III	EU化粧品規則1223/2009の付属書。Annex IIは“完全禁止物質”、Annex IIIは“条件付き使用”。最新版は2024/996で更新。 ￼ ￼
MoCRA (Modernization of Cosmetics Regulation Act)	2022年米国法改正。GMP義務・アレルゲン表示・FDA回収権限が追加された。 ￼
NMPA	中国「国家薬品監督管理局」。2021年CSAR施行で原料安全コード提出が必須に。 ￼ ￼
IFRA	国際香粧品香料協会の自主基準。アレルゲン・感作性のガイドラインとして広く参照。
SDS/MSDS	Safety Data Sheet。輸出国によってフォーマット・言語要件が異なる化学品安全文書。
PAOマーク	Period-After-Opening。開封後に使用可能な期間(例: “12M”)を示すアイコン。



⸻

5. 立ち上げロードマップ（6か月の例）
	1.	Month 1–2: F1–F3 のミニマム実装で EUチェック & PDFラベルβ版
	2.	Month 3–4: CPNP XML / MoCRA CSV 出力、Shopifyプラグイン連携
	3.	Month 5: 中国 NMPA Excel対応、LLM代替案モジュール
	4.	Month 6: 監査ログWORM実装 → ISMS/ISO 27001 準拠ドキュメント整備

⸻

この設計に基づき DBスキーマや OpenAPI 定義を起こす段階へ進める場合、具体的な ER 図や型定義サンプルをすぐ用意できます。次に深掘りしたいパートを教えてください！